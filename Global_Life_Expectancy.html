<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title></title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/simplex.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />
<link rel="stylesheet" href="site_libs\academicons-1.8.0\css\academicons.css" type="text/css" />
<link rel="stylesheet" href="site_libs\font-awesome-4.5.0\css\font-awesome.min.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 41px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 46px;
  margin-top: -46px;
}

.section h2 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h3 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h4 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h5 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h6 {
  padding-top: 46px;
  margin-top: -46px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">dhbostyn</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="publications.html">Publication List</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    My Filedrawer
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="filedrawer1.html">Failed Study 1</a>
    </li>
    <li>
      <a href="filedrawer2.html">Dissapointing Study 2</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Fun Stats
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Global_Life_Expectancy.html">Life Expectancy, then and now</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<div id="life-expectancy-then-and-now" class="section level4">
<h4>Life Expectancy, then and now</h4>
<p>As an amateur statistician, I’m a big fan of the late Hans Rösling and by extension: <a href="https://www.gapminder.org/">GapMinder</a>. If you’re not familiar with their work: they aim to update how we view the world through the visual communication of statistics. For instance, check out this great little tidbit from a <a href="https://www.youtube.com/watch?v=jbkSRLYSojo">BBC show</a>. As it turns out, much of what we think we know about the world is outdated and no longer reflects the current state of affairs. As it also turns out: by alot of metrics, our world has improved tremendously. Most of their stats send a positive and hopeful message. The big picture message is that our world has improved tremendously, even if it doesn’t always feel that way.</p>
<p>I also enjoy messing around with new R packages and data visualization. A while ago, I stumbled upon the <a href="http://rmaps.github.io/%20pacakge">rMaps</a>. Although, it seems that the package hasn’t been updated in a while, it still provides some very interesting functionality that could be used to visualize some of the amazing data provided by Gapminder. More specifcally, it can be used to create animated world maps. As an homage to Gapminder and Hans Rösling, I figured it could be interesting to animate changes to life expectancy on a global world map from 1850 up until now.</p>
<p>the rMaps package is not (yet?) available through CRAN but it can be easily downloaded through github and thus through the “devtools” package. The “devtools” package is typically the easiest way to download packages that are still in development on github. All you need is the url where you can find the package and “devtools” does all the hard work:</p>
<pre class="r"><code>library(devtools)
install_github(&#39;ramnathv/rCharts@dev&#39;)
install_github(&#39;ramnathv/rMaps&#39;)

library(rCharts)
library(rMaps)
library(knitr)</code></pre>
<p>Gapminder also provides the data they use for their analyses freely on their website. You can download it in a number of ways. One of the ways i which they provide their data is through googledocs. Ancient R-wisdom dictates that yes, “there is an R package for that”. In this case, the apptly named “googlesheets” package can come to our rescue. We will also need sile “dplyr” magic. Additionally, we’re going to need the “reshape2” package later on, so we might as well just load it immediately.</p>
<pre class="r"><code>library(googlesheets)
library(plyr)
library(dplyr)
library(rCharts)
library(reshape2)
library(countrycode)</code></pre>
<p>The googlesheets package allows us to extract data from googlesheets through the “key” that is associated with each document. In this case, we want to extract Gapminder’s life expectancy data which we can find in this <a href="https://docs.google.com/spreadsheets/d/1B89xX-0BdNR-qjM7_s5tZi2WCCmobejXd4RaMFKxAIw/">sheet</a>. The key we need is just right there in the url. it’s the weird mess of numbers and letters after the /d/. We just plug it into into the googlesheets “gs_key”&quot; function. We can also chain the “gs_key”&quot; with the “gs_read”&quot; function to extract the data we need like so:</p>
<pre class="r"><code>#Grabbing the data from gapminder
life_exp &lt;- gs_key(&quot;1B89xX-0BdNR-qjM7_s5tZi2WCCmobejXd4RaMFKxAIw&quot;, lookup = FALSE,  verbose=FALSE) %&gt;% 
            gs_read(ws = &quot;Data&quot;, check.names=FALSE)</code></pre>
<p>A quick glance at this data will teach us that Gapminder has managed to find life expectancy data from the year 1765 and upwards for at least a few countries, but frankly speaking: the data is really sparse at that timepoint. Changes to life expectancy also really only start to happen from 1900 onwards. As such, we subset the data. We’re going to start at 1850 but I freely admit that is just a randomly chosen timepoint. However, I do think it is impressive to see how stable life expectancy is from 1850 tp 1900 and how quickly it starts changing from then on.</p>
<p>While we’re at it, the data we have extracted is in <a href="http://www.cookbook-r.com/Manipulating_data/Converting_data_between_wide_and_long_format/">wide format</a> and the rMaps package needs the data to be in long format. The reshape2 package allows us to easily “melt”&quot; our data by specifying which variable groups the individual measurements.</p>
<pre class="r"><code>#Subsetting the data to start from 1850
life_exp &lt;-life_exp[,c(1,87:252)]
life_exp &lt;- na.omit(life_exp)

#Renaming the country-ID variable to something that makes actual sense
colnames(life_exp)[1] &lt;-&quot;Country&quot;

#Melting the data into a long format
life_exp_long &lt;- melt(life_exp, id.var = &quot;Country&quot;)

#Associating ISO3 codes with each country
life_exp_long$Code &lt;- NA
life_exp_long$Code &lt;- countrycode(life_exp_long$Country, &#39;country.name&#39;, &#39;iso3c&#39;)
life_exp_long$Code[life_exp_long$Country == &quot;Central African Rep.&quot;] &lt;-  &quot;CAF&quot;</code></pre>
<p>We are aiming to create a map of the entire world in which each country is color coded according to its life expectancy for a given year. This is a categorical way of displaying our data and thus we need to categorize the life expectancy data into discrete chunks. The rMaps package could take care of that, but it might be better if we do it ourselves so we could split the data into intuitive categories and clearly label each of those categories. We’re also going to associate a color with each of these categories through the “RColorbrewer”&quot; package. It was loaded automatically when we loaded rMaps, so we don’t need to explicitly load it again.</p>
<pre class="r"><code>#Categorizing the data
life_exp_long$fillKey &lt;- NA
life_exp_long$fillKey[life_exp_long$value&lt;80] &lt;- &quot;&gt;70&quot;
life_exp_long$fillKey[life_exp_long$value&lt;70] &lt;- &quot;60 to 70&quot;
life_exp_long$fillKey[life_exp_long$value&lt;60] &lt;- &quot;50 to 60&quot;
life_exp_long$fillKey[life_exp_long$value&lt;50] &lt;- &quot;40 to 50&quot;
life_exp_long$fillKey[life_exp_long$value&lt;40] &lt;- &quot;30 to 40&quot;
life_exp_long$fillKey[life_exp_long$value&lt;30] &lt;- &quot;20 to 30&quot;
life_exp_long$fillKey[life_exp_long$value&lt;20] &lt;- &quot;&lt;20&quot;

fills = setNames(
  c(RColorBrewer::brewer.pal(7, &#39;RdYlGn&#39;), &#39;white&#39;),
  c(c(&quot;&lt;20&quot;,&quot;20 to 30&quot;,&quot;30 to 40&quot;,&quot;40 to 50&quot;,&quot;50 to 60&quot;,&quot;60 to 70&quot;,&quot;&gt;70&quot;), &#39;defaultFill&#39;)
  )</code></pre>
<p>The documentation for the rMaps is somewhat sparse. There are some blog posts available that walk you through an example but the package does not yet have the regular documentation that you can access from R. The easiest way to create our map would be to use the “ichoropleth” function, but I’d like to have a bit more control over the end-result. This can quite easily be achieved by using some javascript. I don’t actually know much javascript. In fact, I don’t really know any javascript at all but it’s easy to tweak the code that is provided on the rMaps blogs. The next bit of code does the following things: first we use “plyr” to turn our dataframe into a list, which is what we’ll eventually feed to “Datamaps”, the javascript framework creating the worldmap in the background. We then make a first, static map, animate it in a second step and finally add a playbutton in the third and final step. This code might look daunting but you only need to change a few things around to get it to work.</p>
<pre class="r"><code>#Turning the data into a list
dat &lt;- dlply(life_exp_long, &quot;variable&quot;, function(x){
  y = toJSONArray2(x, json = F)
  names(y) = lapply(y, &#39;[[&#39;, &#39;Code&#39;)
  return(y)})

#Creating First Choropleth
options(rcharts.cdn = TRUE)
map &lt;- Datamaps$new()
map$set(
  dom = &#39;chart_1&#39;,
  scope = &#39;world&#39;,
  fills = fills,
  data = dat[[1]],
  legend = TRUE,
  labels = FALSE)

#Animated chloropleth
map2 = map$copy()
map2$set(
  bodyattrs = &quot;ng-app ng-controller=&#39;rChartsCtrl&#39;&quot;)

map2$addAssets(
  jshead = &quot;http://cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.1/angular.min.js&quot;)

map2$setTemplate(chartDiv = &quot;
  &lt;div id = &#39;chart_1&#39; class = &#39;rChart datamaps&#39;&gt;
  &lt;input id=&#39;slider&#39; type=&#39;range&#39; min=1850 max=2015 ng-model=&#39;year&#39; width=200&gt;
  &lt;span ng-bind=&#39;year&#39;&gt;&lt;/span&gt;
    
  &lt;script&gt;
    function rChartsCtrl($scope){
      $scope.year = &#39;1850&#39;;
      $scope.$watch(&#39;year&#39;, function(newYear){
        mapchart_1.updateChoropleth(chartParams.newData[newYear]);
      })
    }
  &lt;/script&gt;
  &lt;/div&gt;&quot;)
map2$set(newData = dat)

#Add the play button
map3 = map2$copy()
map3$setTemplate(chartDiv = &quot;
                 &lt;div class=&#39;container&#39;&gt;
                 &lt;button ng-click=&#39;animateMap()&#39;&gt;Play&lt;/button&gt;
                 &lt;div id=&#39;chart_1&#39; class=&#39;rChart datamaps&#39;&gt;&lt;/div&gt;  
                 &lt;/div&gt;
                 &lt;script&gt;
                 function rChartsCtrl($scope, $timeout){
                   $scope.year = 1850;
                   $scope.animateMap = function(){
                     if ($scope.year &gt; 2014){
                       return;
                      }
                   mapchart_1.updateChoropleth(chartParams.newData[$scope.year]);
                   $scope.year += 1
                   $timeout($scope.animateMap, 100)
                   }
                 }
                 &lt;/script&gt;&quot;)
map3</code></pre>
<pre><code>## &lt;iframe src=&#39; Global_Life_Expectancy_files/figure-html/unnamed-chunk-6-1.html &#39; scrolling=&#39;no&#39; frameBorder=&#39;0&#39; seamless class=&#39;rChart datamaps &#39; id=iframe- chart_1 &gt;&lt;/iframe&gt; &lt;style&gt;iframe.rChart{ width: 100%; height: 400px;}&lt;/style&gt;</code></pre>
</div>



<div class="footer">
  <div id="footerhead1">
    <p style="font-size:120%;" >ABOUT</p>
  </div>
  <div id="footerhead2">
    <p style="font-size:120%;" >WHERE</p>
  </div>
  
  <div id="image_about">
    <img src="ProfilePic.png" alt="Profile Picture" style="width:140px;max-height: 100%; display:block; margin:auto;">
  </div>

  
  <div id="about">
    <p style="font-size:110%;">I am a PhD candidate and research assistent at<br>
    the <a href="https://www.vopspsy.ugent.be/en/social-psychology.html">Social Psychology lab</a> in <a href="https://www.ugent.be/en">Ghent University</a>.<br>
    Most of my research focusses on Moral Psychology,<br>
    typically within the Trolley dilemma context.<br>
    Broadly interested in everything on the intersection<br>
    of philosophy and psychology.<br></p>
  </div>
  
  <div id="where">
    <a href="mailto:dries.bostyn@ugent.be"><i class="fa fa-envelope fa-2x"></i></a>
    <a style="padding-left:15px;" href="https://twitter.com/dhbostyn"><i class="fa fa-twitter fa-2x"></i></a>
    <a style="padding-left:15px;" href="https://scholar.google.be/citations?user=4ov3zbUAAAAJ&hl=en"><i class="ai ai-google-scholar ai-2x"></i></a>
    <a style="padding-left:15px;" href="https://www.researchgate.net/profile/Dries_Bostyn"><i class="ai ai-researchgate ai-2x"></i></a>
    <a style="padding-left:15px;" href="https://www.orcid.org/0000-0001-9994-4615"><i class="ai ai-orcid ai-2x"></i></a>

  </div>
  
</div>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
